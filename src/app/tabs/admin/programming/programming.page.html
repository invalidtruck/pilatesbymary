<ion-header [translucent]="true">
  <ion-toolbar>
    <!-- <ion-buttons slot="start">
      <ion-button> Start </ion-button>
    </ion-buttons> -->
    <ion-title>Programar clases</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="setOpenModal()">
        <ion-icon slot="icon-only" ios="add-circle-outline" md="add-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-progress-bar type="indeterminate" *ngIf="isConsulting"></ion-progress-bar>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true">
  <ion-grid>
    <ion-row>
      <ion-col></ion-col>
      <ion-col>
        <div class="ion-text-center">
          <ion-datetime [min]="today" mode="ios" locale="es-MX" presentation="date" (ionChange)="SelDia($event)">
          </ion-datetime>
        </div>
      </ion-col>
      <ion-col></ion-col>
    </ion-row>
    <ion-row style="background-color: rgb(209, 209, 209); height: 100%;">
      <ion-col>
        <ion-list [inset]="true">
          <ion-item *ngFor="let hora of horarios">
            <ion-grid>
              <ion-col size="3">
                <ion-badge color="primary" mode="ios" (click)="setOpenModal(hora)">{{hora}}</ion-badge>
              </ion-col>
              <ion-col size="9">
                <ng-container *ngIf="haySesionesEnHora(hora)">
                  <!-- Aplicar estilo CSS para el ancho completo -->
                  <ion-list *ngFor="let sesion of getSesionesEnHora(hora)" style="width: 100%;">
                    <ion-item [button]="true" (click)="getDetalleClase(sesion)">
                      <ion-label><strong>{{ getClaseName(sesion.uid) }}</strong></ion-label>
                      <!-- <ion-label>{{ getRegistroClases(sesion.uid) }} -- {{ getClaseName(sesion.uid) }}</ion-label> -->
                    </ion-item>
                  </ion-list>
                </ng-container>
              </ion-col>
            </ion-grid>
          </ion-item>
        </ion-list>
        <!-- <ion-list [inset]="true"  >
          <ion-item *ngFor="let sesion of Sesiones" [button]="true" >
            <ion-label>
              <h1>{{ sesion.hora }}</h1> 
              <ion-note color="medium">Usuarios:
                <span *ngFor="let reg of getRegistroClases(sesion.uid) ">
                  {{ reg.fullName }} , {{getClaseName(sesion.uid)}}
                </span>
              </ion-note>
            </ion-label>
           
            <div class="metadata-end-wrapper" slot="end">
              <ion-note color="medium">{{ sesion.duracion }} minutos</ion-note>
            </div>
          </ion-item>
        </ion-list>  -->
      </ion-col>
    </ion-row>
  </ion-grid>
  <div class="background">

  </div>


  <ion-modal [isOpen]="isModalOpen" canDismiss="true" (willDismiss)="onWillDismiss($event)"
    (willPresent)="WillPresent($event)">
    <ng-template>
      <ion-content class="ion-padding">
        <form [formGroup]="form" (ngSubmit)="confirm()">
          <div class="modal-header ion-text-center">
            <ion-icon class="larger" slot="start" name="calendar"></ion-icon>
            <br><label>{{selDate| date: 'dd MMM yy'}}</label>
          </div>
          <ion-item>
            <ion-grid>
              <ion-row>
                <ion-col>
                  <ion-input fill="" label="Nombre de la clase" labelPlacement="stacked" type="text"
                    placeholder="PILATES" formControlName="clase" class="full-width"></ion-input>
                  <div class="validation-error"
                    *ngIf="form.get('clase').hasError('required') && form.get('clase').touched">
                    El nombre de la clase es obligatorio.
                  </div>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col>
                  <ion-input label="Total Asistentes" labelPlacement="stacked" min="0" type="number" placeholder="10"
                    formControlName="total" class="full-width"></ion-input>
                  <div class="validation-error"
                    *ngIf="form.get('total').hasError('required') && form.get('total').touched">
                    La cantidad de asistentes es obligatoria.
                  </div>
                  <div class="validation-error" *ngIf="form.get('total').hasError('min') && form.get('total').touched">
                    La cantidad debe ser un número no negativo.
                  </div>
                </ion-col>
                <ion-col></ion-col>
                <ion-col>
                  <ion-input label="Lista de espera" labelPlacement="stacked" min="0" type="number" placeholder="5"
                    formControlName="listaespera" class="full-width"></ion-input>
                  <div class="validation-error"
                    *ngIf="form.get('listaespera').hasError('required') && form.get('listaespera').touched">
                    La lista de espera es obligatoria.
                  </div>
                  <div class="validation-error"
                    *ngIf="form.get('listaespera').hasError('min') && form.get('listaespera').touched">
                    el total de lista de espera debe ser un número no negativo.
                  </div>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col>
                  <ion-item>
                    <ion-select *ngIf="selHora === null" formControlName="hora" label="Hora" [value]="selHora"
                      labelPlacement="stacked" multiple="false" placeholder="Selecciona una hora">
                      <ion-select-option *ngFor="let hr of horarios" [value]="hr">{{hr}}</ion-select-option>
                    </ion-select>
                    <ion-input *ngIf="selHora != null" label="Hora" labelPlacement="stacked" min="0" type="text"
                      disabled="disabled" class="full-width" [value]="selHora"></ion-input>
                  </ion-item>
                  <div class="validation-error"
                    *ngIf="form.get('hora').hasError('required') && form.get('hora').touched">
                    campo requerido
                  </div>
                  <div class="validation-error" *ngIf="form.get('hora').hasError('min') && form.get('hora').touched">
                    valor no valido
                  </div>
                </ion-col>
                <ion-col>
                  <ion-input label="Duración" labelPlacement="stacked" min="0" type="number" placeholder="50"
                    formControlName="duracion" class="full-width"></ion-input>
                  <div class="validation-error"
                    *ngIf="form.get('duracion').hasError('required') && form.get('duracion').touched">
                    La duración es obligatoria.
                  </div>
                  <div class="validation-error"
                    *ngIf="form.get('duracion').hasError('min') && form.get('duracion').touched">
                    La duración debe ser un número no negativo.
                  </div>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
          <ion-footer style="position: absolute; bottom: 0; left: 0;">
            <ion-header>
              <ion-toolbar style="padding-right: 15px;">
                <ion-buttons slot="end">
                  <ion-button color="danger" (click)="cancel()">Cancelar</ion-button>
                  <ion-button color="primary" type="submit">Programar</ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
          </ion-footer>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>